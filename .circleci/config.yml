version: 2.1

orbs:
  ci: bigcommerce/internal@volatile
  node: bigcommerce/internal-node@volatile

node_executor: &node_executor
  docker:
    - image: circleci/node:10-browsers

commands:
  install-dependencies:
    steps:
      - ci/pre-setup
      - node/yarn-install
  unit-test:
    steps:
      - run:
          name: Unit Tests # Jest unit tests
          command: ./node_modules/.bin/codeceptjs run --reporter mocha-junit-reporter
          # TODO
          # command: yarn test
      - store_test_results:
          path: ./test-reports
  # TODO
  # functional-test:
  #   steps:
  #     - run:
  #         name: Functional Tests # CodeceptJS functional tests
  #         command: yarn functional:ci
  #     - store_test_results:
  #         path: ./test-reports

jobs:
  unit-tests:
    <<: *node_executor
    resource_class: small
    steps:
      - install-dependencies
      - unit-test
  # TODO
  # functional-tests:
  #   <<: *node_executor
  #   resource_class: small
  #   steps:
  #     - install-dependencies
  #     - functional-test


workflows:
  full:
    jobs:
      - unit-tests
      # TODO
      # - functional-tests
